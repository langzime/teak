<#import "../lib.html" as lib>
<!DOCTYPE html>
<html>
<head>
	<@lib.meta />
	<#if user??>
		<title>Update User</title>
	<#else>
		<title>Add User</title>
	</#if>
	<@lib.css />
</head>
<body>
	
	<div class="container">
	
		<@lib.header />
		<@lib.nav />
		
		<div class="row" style="margin-top:20px">
			<div class="span2">
				<@lib.AdminLeftNav />
			</div> <!-- span2 -->
			<div class="span6">
				<#if user??>
					<form id="user-form" class="form-horizontal" action="/admin/user/${user.id}/update" method="post">
				<#else>
					<form id="user-form" class="form-horizontal" action="/admin/user" method="post">
				</#if>
					<fieldset>
						<#if user??>
							<legend>修改管理员密码</legend>
						<#else>
							<legend>新增User</legend>
						</#if>
						<div class="control-group">
							<label class="control-label">旧密码</label>
							<div class="controls">
								<input id="oldPassword" type="password" class="input-xlarge" name="oldPassword" maxlength="30">
							</div>
						</div>
						<div class="control-group">
							<label class="control-label">新密码</label>
							<div class="controls">
								<input id="newPassword" type="password" class="input-xlarge" name="newPassword" maxlength="30">
							</div>
						</div>
						<div class="control-group">
							<label class="control-label">新密码确认</label>
							<div class="controls">
								<input id="newConfirmPassword" type="password" class="input-xlarge" name="newConfirmPassword" maxlength="30">
							</div>
						</div>
						<!-- control-group -->
						<div class="form-actions">
							<button type="submit" class="btn btn-primary">保存</button>
							<a class="btn" href="/admin">返回</a>
						</div>
					</fieldset>
				</form>	
			</div>
		</div>
		
		<@lib.bottom />
	</div>
  <@lib.js />
  <script>
		$(function(){
			$('#collapseUser').addClass('in');
			$('#user-form').submit(function(e){
	  			$('#oldPassword').val(CryptoJS.MD5($('#oldPassword').val()));
	  			$('#newPassword').val(CryptoJS.MD5($('#newPassword').val()));
	  			$('#newConfirmPassword').val(CryptoJS.MD5($('#newConfirmPassword').val()));
	  			if ($('#newConfirmPassword').val() == $('#newPassword').val()) {
	  				return true;
	  			}
	  			else {
	  				alert("两次密码输入不一致");
	  				$('#oldPassword').val("");
		  			$('#newPassword').val("");
		  			$('#newConfirmPassword').val("");
	  				return false;
	  			}
	  		});
		});
	</script>
</body>
</html>